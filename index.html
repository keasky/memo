<!-- templates/index.html -->
<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>共有掲示板</title>
<style>
body{font-family:system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "メイリオ", sans-serif;padding:18px}
textarea{width:100%;box-sizing:border-box}
#posts article{border-bottom:1px solid #ddd;padding:8px 0}
.time{font-size:12px;color:#666}
</style>
</head>
<body>
<h1>みんなで書き込む掲示板</h1>
<textarea id="content" rows="6" placeholder="ここに書く"></textarea>
<br/>
<button id="send">投稿</button>
<section id="posts"></section>

<script>
function escapeHtml(s){ return s.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;"); }
async function loadPosts(){
  const r = await fetch('/api/posts');
  const data = await r.json();
  const el = document.getElementById('posts');
  el.innerHTML = data.map(p=>`<article><div class="time">${new Date(p.created_at).toLocaleString()}</div><p>${escapeHtml(p.content)}</p></article>`).join('');
}
document.getElementById('send').onclick = async ()=>{
  const t = document.getElementById('content');
  if(!t.value.trim()){ alert('内容を入力してください'); return; }
  const res = await fetch('/api/posts',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({content:t.value})});
  if(res.ok){ t.value=''; loadPosts(); } else { const e = await res.json(); alert(e.error||'失敗'); }
};
loadPosts();
setInterval(loadPosts, 5000); // 5秒ごとに更新（簡易）
</script>
</body>
</html>
